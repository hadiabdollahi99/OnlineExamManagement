<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙˆØ§Ù„Ø§Øª Ø¢Ø²Ù…ÙˆÙ†</title>
    <style>
        body {
            font-family: Arial;
            margin: 20px;
            background: #f5f5f5;
        }
        .header {
            background: #333;
            color: white;
            padding: 15px;
            margin-bottom: 20px;
        }
        .header a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
        }
        .header a:hover {
            text-decoration: underline;
        }
        .exam-info {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }
        .actions {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
        }
        .btn {
            padding: 10px 15px;
            margin: 5px;
            text-decoration: none;
            color: white;
            display: inline-block;
        }
        .btn-add-bank {
            background: #28a745;
        }
        .btn-add-new {
            background: #17a2b8;
        }
        .btn-back {
            background: #6c757d;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: right;
        }
        th {
            background: #f8f9fa;
        }
        .score-input {
            width: 80px;
            padding: 5px;
        }
        .total-score {
            background: #e9f7ef;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #28a745;
        }
        .no-questions {
            text-align: center;
            padding: 40px;
            color: #666;
            background: white;
            border: 1px solid #ddd;
        }
        .success {
            color: green;
            padding: 10px;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            margin: 10px 0;
        }
        .error {
            color: #721c24;
            padding: 10px;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            margin: 10px 0;
        }
        .question-type {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 10px;
            background: #e9ecef;
        }
        form {
            display: inline;
        }
        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
        .save-btn {
            background: #ffc107;
            color: black;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            margin-left: 5px;
        }
    </style>
</head>
<body>
<div class="header">
    <a href="/teacher/dashboard">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
    <a href="/teacher/courses">Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†</a>
    <a href="/teacher/my-exams">Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ù…Ù†</a>
    <form th:action="@{/logout}" method="post">
        <button type="submit">Ø®Ø±ÙˆØ¬</button>
    </form>
</div>

<div class="exam-info">
    <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙˆØ§Ù„Ø§Øª Ø¢Ø²Ù…ÙˆÙ†</h2>
    <p><strong>Ø¢Ø²Ù…ÙˆÙ†:</strong> <span th:text="${exam?.title}"></span></p>
    <p><strong>Ø¯ÙˆØ±Ù‡:</strong> <span th:text="${exam?.course?.title}"></span></p>
    <p><strong>Ú©Ø¯ Ø¯ÙˆØ±Ù‡:</strong> <span th:text="${exam?.course?.courseCode}"></span></p>
</div>

<div class="actions">
    <h3>Ø§ÙØ²ÙˆØ¯Ù† Ø³ÙˆØ§Ù„ Ø¬Ø¯ÛŒØ¯:</h3>
    <a th:href="@{/teacher/questions/exam/{id}/add-from-bank(id=${exam?.id})}"
       class="btn btn-add-bank">â• Ø§Ø² Ø¨Ø§Ù†Ú© Ø³ÙˆØ§Ù„Ø§Øª</a>
    <a th:href="@{/teacher/questions/exam/{id}/create-new/select-type(id=${exam?.id})}"
       class="btn btn-add-new">ğŸ†• Ø§ÛŒØ¬Ø§Ø¯ Ø³ÙˆØ§Ù„ Ø¬Ø¯ÛŒØ¯</a>
    <a th:href="@{/teacher/exams/{id}(id=${exam?.id})}"
       class="btn btn-back">â† Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¢Ø²Ù…ÙˆÙ†</a>
</div>

<div th:if="${examQuestions == null or examQuestions.isEmpty()}">
    <div class="no-questions">
        <p>Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø³ÙˆØ§Ù„ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ø¢Ø²Ù…ÙˆÙ† Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
        <p>Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø³ÙˆØ§Ù„Ø§Øª Ø±Ø§ Ø§Ø² Ø¨Ø§Ù†Ú© Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙˆØ§Ù„ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯.</p>
    </div>
</div>

<div th:if="${examQuestions != null and not examQuestions.isEmpty()}">
    <h3>Ø³ÙˆØ§Ù„Ø§Øª Ø¢Ø²Ù…ÙˆÙ† (<span th:text="${examQuestions.size()}"></span> Ø³ÙˆØ§Ù„)</h3>

    <table>
        <thead>
        <tr>
            <th>Ø±Ø¯ÛŒÙ</th>
            <th>Ø¹Ù†ÙˆØ§Ù† Ø³ÙˆØ§Ù„</th>
            <th>Ù†ÙˆØ¹ Ø³ÙˆØ§Ù„</th>
            <th>Ù…ØªÙ† Ø³ÙˆØ§Ù„</th>
            <th>Ù†Ù…Ø±Ù‡ Ù¾ÛŒØ´ÙØ±Ø¶</th>
            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
        </tr>
        </thead>
        <tbody>
        <th:block th:each="item, iter : ${examQuestions}">
            <tr th:if="${item != null}">
                <td th:text="${iter.count}"></td>
                <td th:text="${item?.question?.title ?: 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}"></td>
                <td>
                    <span class="question-type"
                          th:text="${item?.question?.questionType?.name() == 'DESCRIPTIVE' ? 'ØªØ´Ø±ÛŒØ­ÛŒ' :
                                   item?.question?.questionType?.name() == 'MULTIPLE_CHOICE' ? 'Ú†Ù†Ø¯Ú¯Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ' :
                                   'Ù†Ø§Ù…Ø´Ø®Øµ'}">
                    </span>
                </td>
                <td>
                    <span th:if="${item?.question?.questionText != null and #strings.length(item.question.questionText) > 50}"
                          th:text="${#strings.substring(item.question.questionText, 0, 50)} + '...'"></span>
                    <span th:if="${item?.question?.questionText != null and #strings.length(item.question.questionText) <= 50}"
                          th:text="${item.question.questionText}"></span>
                    <span th:if="${item?.question?.questionText == null}">-</span>
                </td>
                <td>
                    <form th:action="@{/teacher/questions/exam-question/{id}/update-score(id=${item?.id})}"
                          method="post" th:if="${item?.id != null}">
                        <input type="number" name="newScore"
                               th:value="${item?.defaultScore ?: 0}"
                               step="0.5" min="0" max="100" class="score-input">
                        <button type="submit" class="save-btn">Ø°Ø®ÛŒØ±Ù‡</button>
                    </form>
                    <span th:if="${item?.id == null}">-</span>
                </td>
                <td>
                    <form th:action="@{/teacher/questions/exam-question/{id}/delete(id=${item?.id})}"
                          method="post" th:if="${item?.id != null}">
                        <button type="submit" class="delete-btn"
                                onclick="return confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø³ÙˆØ§Ù„ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')">
                            Ø­Ø°Ù
                        </button>
                    </form>
                    <span th:if="${item?.id == null}">-</span>
                </td>
            </tr>
        </th:block>
        </tbody>
    </table>

    <div class="total-score">
        <h3>Ù†Ù…Ø±Ù‡ Ú©Ù„ Ø¢Ø²Ù…ÙˆÙ†: <span th:text="${totalScore != null ? totalScore : 0}"></span> Ù†Ù…Ø±Ù‡</h3>
    </div>
</div>
</body>
</html>